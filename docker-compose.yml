version: "3.9"

services:
  gateway:
    build:
      context: .
      dockerfile: ApiGateway/Dockerfile
    ports:
      - "8080:8080"
    environment:
      - ASPNETCORE_URLS=http://+:8080
      - Services__FileStorage=http://file-storage:8080
      - Services__Analysis=http://analysis:8080
    depends_on:
      - file-storage
      - analysis

  file-storage:
    build:
      context: .
      dockerfile: FileStorageService/Dockerfile
    environment:
      - ASPNETCORE_URLS=http://+:8080
      - ConnectionStrings__DefaultConnection=Data Source=filestorage.db
    volumes:
      - file_storage_files:/app/files

  analysis:
    build:
      context: .
      dockerfile: FileAnalysisService/Dockerfile
    environment:
      - ASPNETCORE_URLS=http://+:8080
      - ConnectionStrings__DefaultConnection=Data Source=analysis.db
      - Services__FileStorage=http://file-storage:8080
    depends_on:
      - file-storage

volumes:
  file_storage_files:
